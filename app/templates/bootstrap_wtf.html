{% macro render_field(field, label_visible=true, form_type="basic", horizontal_columns=('lg', 2, 8), button_map={}, **kwargs) %}
    {% if field.type == 'CSRFTokenField' or field.type == 'HiddenField' %}
        {{ field() }}
    {% else %}
        <div class="form-group {% if field.errors %}has-error{% endif %}">
            {% if label_visible %}
                {{ field.label(class="form-control-label " + ( "col-" + horizontal_columns[0] + "-" + horizontal_columns[1] if form_type == "horizontal" else "" )) }}
            {% endif %}

            {% if form_type == "horizontal" %}
            <div class="col-{{ horizontal_columns[0] }}-{{ horizontal_columns[2] }}">
            {% endif %}

            {% if field.type == 'SubmitField' %}
                {{ field(class="btn " + button_map.get(field.id, "btn-primary")) }}
            {% elif field.type == 'BooleanField' %}
                <div class="form-check">
                    {{ field(class="form-check-input " + ("is-invalid" if field.errors else ""), id=field.id) }}
                    {{ field.label(class="form-check-label", for=field.id) }}
                </div>
            {% elif field.type == 'TextAreaField' %}
                {{ field(class="form-control" + (" is-invalid" if field.errors else ""), rows=4, **kwargs) }}
            {% elif field.type == 'SelectField' %}
                {{ field(class="form-select" + (" is-invalid" if field.errors else ""), **kwargs) }}
            {% else %}
                {{ field(class="form-control" + (" is-invalid" if field.errors else ""), **kwargs) }}
            {% endif %}

            {% if field.errors %}
                {% for error in field.errors %}
                    <div class="invalid-feedback d-block" role="alert">{{ error }}</div>
                {% endfor %}
            {% endif %}

            {% if form_type == "horizontal" %}
            </div>
            {% endif %}
        </div>
    {% endif %}
{% endmacro %}

{% macro render_form(form, action_url, form_type="basic", horizontal_columns=('lg', 2, 8), button_map={}, **kwargs) %}
    <form method="POST" action="{{ action_url }}" novalidate
        {% if form_type == "horizontal" %}class="form-horizontal"{% endif %}
        {% for attr, val in kwargs.items() %}
            {{ attr }}="{{ val }}"
        {% endfor %}>
        {{ form.hidden_tag() }}
        {% for field in form %}
            {{ render_field(field, label_visible=true, form_type=form_type, horizontal_columns=horizontal_columns, button_map=button_map) }}
        {% endfor %}
    </form>
{% endmacro %}
