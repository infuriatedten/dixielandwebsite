{# This is a helper for rendering Flask-WTF forms with Bootstrap styling #}
{% macro render_field(field, label_visible=true, form_type="basic", horizontal_columns=('lg', 2, 8), button_map={}) %}
    {% if field.type == 'CSRFTokenField' or field.type == 'HiddenField' %}
        {{ field() }}
    {% else %}
        <div class="form-group {% if field.errors %}has-error{% endif %}">
            {% if label_visible %}
                {{ field.label(class="form-control-label " + ( "col-" + horizontal_columns[0] + "-" + horizontal_columns[1] if form_type == "horizontal" else "" ) ) }}
            {% endif %}

            {% if form_type == "horizontal" %}
            <div class="col-{{ horizontal_columns[0] }}-{{ horizontal_columns[2] }}">
            {% endif %}

            {% if field.type == 'SubmitField' %}
                {{ field(class="btn " + button_map.get(field.id, "btn-primary") ) }}
            {% elif field.type == 'BooleanField' %}
                 <div class="form-check">
                    {{ field(class="form-check-input " + ( field.flags.error_class if field.flags.error_class else "")) }}
                    {{ field.label(class="form-check-label") }}
                </div>
            {% else %}
                {{ field(class="form-control " + ( field.flags.error_class if field.flags.error_class else ""), **kwargs) }}
            {% endif %}

            {% if field.errors %}
                {% for error in field.errors %}
                    <span class="help-block text-danger">{{ error }}</span><br>
                {% endfor %}
            {% endif %}

            {% if form_type == "horizontal" %}
            </div>
            {% endif %}
        </div>
    {% endif %}
{% endmacro %}

{% macro render_form(form, action_url, form_type="basic", horizontal_columns=('lg', 2, 8), button_map={}) %}
    <form method="POST" action="{{ action_url }}" novalidate
        {% if form_type == "horizontal" %}class="form-horizontal"{% endif %}>
        {{ form.hidden_tag() }}
        {% for field in form %}
            {{ render_field(field, label_visible=true, form_type=form_type, horizontal_columns=horizontal_columns, button_map=button_map) }}
        {% endfor %}
    </form>
{% endmacro %}
