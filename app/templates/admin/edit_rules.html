{% extends "admin/base.html" %}
{% import "bootstrap_wtf.html" as wtf %}

{% block admin_content %}
<p style="background-color: yellow; color: black; padding: 10px; font-weight: bold;">
    DEBUG: INSIDE ADMIN CONTENT BLOCK. Form is: {{ form }} --- Title is: {{ title }} --- Rules Entry is: {{ rules_entry }}
</p>
<div class="container mt-4">
    <h2>{{ title }}</h2>

    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    Edit Rules Content (Markdown Supported)
                </div>
                <div class="card-body">
                    <p>Debug: Form object is: {{ form }}</p>
                    <p>Debug: Form CSRF token is: {{ form.csrf_token }}</p>
                    <p>Debug: Form content_markdown field is: {{ form.content_markdown }}</p>
                    <p>Debug: Form submit field is: {{ form.submit }}</p>
                    <hr>
                    <p>Attempting to render content_markdown label: {{ form.content_markdown.label }}</p>
                    <p>Attempting to render content_markdown field: {{ form.content_markdown() }}</p>
                </div>
                <div class="card-footer text-muted small">
                    {% if rules_entry and rules_entry.last_edited_on %}
                        Last updated on {{ rules_entry.last_edited_on.strftime('%Y-%m-%d %H:%M:%S') }} UTC
                        {% if rules_entry.last_edited_by %}
                            by {{ rules_entry.last_edited_by.username }}
                        {% endif %}
                    {% else %}
                        Rules have not been saved yet.
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    Markdown Preview (How it will look on the Rules page)
                </div>
                <div class="card-body" id="markdown-preview">
                    <p class="text-muted"><em>Preview will update as you type (JavaScript needed for live preview). For now, this is a static placeholder or would show saved content if `preview_html` was passed from route.</em></p>
                    {# Example: If you pass preview_html from the route after processing markdown #}
                    {# {{ preview_html|safe if preview_html else "Start typing in the editor to see a preview." }} #}
                    {% if form.content_markdown.data %}
                        <p><em>Content will be rendered as HTML on the public rules page. Basic preview:</em></p>
                        <pre style="white-space: pre-wrap; word-wrap: break-word;">{{ form.content_markdown.data }}</pre>
                        <p class="mt-2 text-info small">Note: This is a raw text preview. The actual page will render Markdown to HTML.</p>
                    {% else %}
                         <p>No content yet.</p>
                    {% endif %}
                </div>
            </div>
            <div class="alert alert-info mt-3 small">
                <h5 class="alert-heading">Markdown Tips</h5>
                <ul>
                    <li><code># Heading 1</code>, <code>## Heading 2</code></li>
                    <li><code>**Bold**</code> or <code>__Bold__</code></li>
                    <li><code>*Italic*</code> or <code>_Italic_</code></li>
                    <li><code>[Link Text](https://example.com)</code></li>
                    <li><code>- Item 1</code><br><code>- Item 2</code> (for lists)</li>
                    <li><code>1. Item 1</code><br><code>2. Item 2</code> (for numbered lists)</li>
                    <li>Leave a blank line for a new paragraph.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

{# Optional: Add JavaScript for live Markdown preview if desired #}
{# 
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const markdownInput = document.getElementById('content_markdown'); // Ensure your TextAreaField has this ID
    const previewOutput = document.getElementById('markdown-preview');

    if (markdownInput && previewOutput) {
        function updatePreview() {
            previewOutput.innerHTML = marked.parse(markdownInput.value);
        }
        markdownInput.addEventListener('input', updatePreview);
        updatePreview(); // Initial preview
    }
});
</script>
#}
{% endblock %}
