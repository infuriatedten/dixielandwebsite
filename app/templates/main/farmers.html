{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4">Farmers Dashboard</h1>

    <!-- Banking Info Card -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex align-items-center">
            <i class="bi bi-wallet2 fs-4 me-2"></i>
            <h5 class="mb-0">Banking Information</h5>
        </div>
        <div class="card-body">
            {% if bank_accounts %}
                <ul class="list-group list-group-flush">
                {% for account in bank_accounts %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ account.name }}</strong>
                            <small class="text-muted">({{ account.currency }})</small>
                        </div>
                        <span class="badge bg-success fs-6">{{ account.balance | round(2) }}</span>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-info mb-0">No banking information available.</div>
            {% endif %}
        </div>
    </div>

    <!-- Owned Parcels & Insurance Claims -->
    <div class="row mb-4">
        <!-- Owned Parcels -->
        <div class="col-lg-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-header d-flex align-items-center">
                    <i class="bi bi-geo-alt fs-4 me-2"></i>
                    <h5 class="mb-0">Owned Parcels</h5>
                </div>
                <div class="card-body">
                    {% if parcels %}
                        <p><strong>Total Acres Owned:</strong> {{ total_acres }}</p>
                        <ul class="list-group list-group-flush">
                        {% for parcel in parcels %}
                            <li class="list-group-item">
                                <strong>{{ parcel.location }}</strong> &mdash; {{ parcel.size }} acres
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <div class="alert alert-warning mb-0">You currently do not own any parcels.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Insurance Claims -->
        <div class="col-lg-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-header d-flex align-items-center">
                    <i class="bi bi-file-medical fs-4 me-2"></i>
                    <h5 class="mb-0">Insurance Claims</h5>
                </div>
                <div class="card-body">
                    {% if insurance_claims %}
                        <ul class="list-group list-group-flush">
                        {% for claim in insurance_claims %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">{{ claim.claim_date.strftime('%b %d, %Y') }}</small><br />
                                    <strong>{{ claim.reason }}</strong>
                                </div>
                                <span class="badge 
                                    {% if claim.status.value == 'APPROVED' %}bg-success
                                    {% elif claim.status.value == 'PENDING' %}bg-warning text-dark
                                    {% else %}bg-secondary
                                    {% endif %}">
                                    {{ claim.status.value.capitalize() }}
                                </span>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <div class="alert alert-info mb-0">No insurance claims submitted.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Registered Vehicles -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex align-items-center">
            <i class="bi bi-truck fs-4 me-2"></i>
            <h5 class="mb-0">Registered Vehicles</h5>
        </div>
        <div class="card-body">
            {% if vehicles %}
                <ul class="list-group list-group-flush">
                {% for vehicle in vehicles %}
                    <li class="list-group-item">
                        <strong>{{ vehicle.license_plate }}</strong> &mdash; {{ vehicle.vehicle_make }} {{ vehicle.vehicle_model }}
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-warning mb-0">No vehicles registered.</div>
            {% endif %}
        </div>
    </div>

    <!-- Two Column Forms -->
    <div class="row">
        <!-- Add New Parcel Form -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <i class="bi bi-plus-square fs-5 me-2"></i>Add a New Parcel
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.farmers') }}">
                        {{ parcel_form.hidden_tag() }}
                        <div class="mb-3">
                            {{ parcel_form.location.label(class="form-label") }}
                            {{ parcel_form.location(class="form-control", placeholder="Parcel location/address") }}
                            {% for err in parcel_form.location.errors %}
                                <div class="form-text text-danger">{{ err }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ parcel_form.size.label(class="form-label") }}
                            {{ parcel_form.size(class="form-control", placeholder="Size in acres") }}
                            {% for err in parcel_form.size.errors %}
                                <div class="form-text text-danger">{{ err }}</div>
                            {% endfor %}
                        </div>
                        {{ parcel_form.submit(class="btn btn-primary", name="submit_parcel") }}
                    </form>
                </div>
            </div>
        </div>

        <!-- Submit Insurance Claim Form -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <i class="bi bi-file-earmark-medical fs-5 me-2"></i>Submit an Insurance Claim
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.farmers') }}">
                        {{ insurance_form.hidden_tag() }}
                        <div class="mb-3">
                            {{ insurance_form.reason.label(class="form-label") }}
                            {{ insurance_form.reason(class="form-control", placeholder="Reason for claim") }}
                            {% for err in insurance_form.reason.errors %}
                                <div class="form-text text-danger">{{ err }}</div>
                            {% endfor %}
                        </div>
                        {{ insurance_form.submit(class="btn btn-primary", name="submit_insurance") }}
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
