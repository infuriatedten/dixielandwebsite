{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Contracts</h1>

    <!-- Simple nav pills for Farmers section navigation -->
    <nav>
        <ul class="nav nav-pills mb-3">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.farmer_dashboard') }}">Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="{{ url_for('main.contracts') }}">Contracts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.company') }}">Manage Company</a>
            </li>
        </ul>
    </nav>

    <a href="{{ url_for('main.create_contract') }}" class="btn btn-primary mb-3">Create Contract</a>
    <div class="row">
        {% if contracts %}
            {% for contract in contracts %}
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">{{ contract.title }}</h5>
                        <p class="card-text">{{ contract.description | truncate(100) }}</p>
                        <p class="card-text"><strong>Reward:</strong> {{ contract.reward }}</p>
                        <p class="card-text"><strong>Status:</strong> {{ contract.status }}</p>
                        {% if contract.creator_id == current_user.id %}
                            <a href="{{ url_for('main.delete_contract', contract_id=contract.id) }}" class="btn btn-danger">Delete Contract</a>
                        {% elif contract.claimant_id == current_user.id and contract.status == 'CLAIMED' %}
                            <a href="{{ url_for('main.complete_contract', contract_id=contract.id) }}" class="btn btn-success">Complete Contract</a>
                        {% elif contract.claimant_id and contract.claimant_id != current_user.id %}
                            <button class="btn btn-secondary" disabled>Claimed</button>
                        {% else %}
                            <a href="{{ url_for('main.claim_contract', contract_id=contract.id) }}" class="btn btn-primary">Claim Contract</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No contracts available at the moment.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
